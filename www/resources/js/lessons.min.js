"use strict";$(function(){var t=$("<form method='POST' id='js_form'>\t\t\t\t\t\t<p>Tantárgy neve: <input type='text' name='name' value='' pattern='^[A-Za-zöüóőúéáűÖÜÓŐÚÉÁŰ.() ]{4,15}$' required placeholder='Tantárgy'></p>\t\t\t\t\t\t<p>Előadó (tanár) neve:\t\t\t\t\t\t\t<select name='teacherid'>\t\t\t\t\t\t\t</select>\t\t\t\t\t\t</p>\t\t\t\t\t\t<p>Tantárgy színe: <input id='colorpicker' name='color' type='hidden' value='#000000'></p>\t\t\t\t\t\t<input type='hidden' name='id' value=''>\t\t\t\t\t</form>"),e=$("<li>\t\t\t\t\t\t\t<div class='top'>\t\t\t\t\t\t\t\t<span class='tantargy'></span>\t\t\t\t\t\t\t\t<span class='tanar'></span>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div class='bottom'>\t\t\t\t\t\t\t\t<a class='typcn typcn-pencil js_lesson_edit' href='' title='Módosítás'></a>\t\t\t\t\t\t\t\t<a class='typcn typcn-trash js_lesson_delete' href='' title='Törlés'></a>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</li>"),a="";$.ajax({method:"POST",url:"/lessons/get/teachers",data:pushToken({}),success:function(t){return"string"==typeof t?(console.log(t),$(window).trigger("ajaxerror"),!1):void(t.options&&$.each(t.options,function(t,e){a+=e}))}});var n=function(e){e.preventDefault();var n="Tantárgy szerkesztése",r=$(e.currentTarget).attr("href").substring(1);$.ajax({method:"POST",url:"/lessons/get",data:pushToken({id:r}),success:function(e){if("string"==typeof e)return console.log(e),$(window).trigger("ajaxerror"),!1;var s=t.clone();s.find("[name=name]").attr("value",e.name),s.find("[name=color]").attr("value",e.color),s.find("[name=id]").attr("value",e.id),s.find("[name=teacherid]").append(a).children("option[value="+e.teacherid+"]").attr("selected",!0),$.Dialog.request(n,s.prop("outerHTML"),"js_form","Mentés",function(t){$("#colorpicker").spectrum({showInput:!0,showInitial:!0,preferredFormat:"hex",change:function(t){$("#colorpicker").attr("value",t.toHexString())}}),t.on("submit",function(e){e.preventDefault();var a=t.serializeForm();$.Dialog.wait(n),$.ajax({method:"POST",url:"/lessons/edit",data:a,success:function(e){if("string"==typeof e)return console.log(e),$(window).trigger("ajaxerror"),!1;if(e.status){var a=$("ul").children("[data-id="+r+"]"),s=t.children();a.find(".tantargy").text(s.find("[name=name]").val()),a.find(".tanar").text(s.find("[name=teacherid]").find(":selected").text()),a.css("background-color",s.find("[name=color]").val());var o=$(".lessons"),i=$(".new").detach();o.sortChildren(".tantargy",!1),o.append(i),$.Dialog.close()}else $.Dialog.fail(n,e.message)}})})})}})},r=function(t){t.preventDefault();var e="Tantárgy törlése";$.Dialog.confirm(e,"Biztosan szeretnéd törölni a tantárgyat?",["Tantárgy törlése","Visszalépés"],function(a){if(a){var n=$(t.currentTarget).attr("href").substring(1);$.Dialog.wait(e),$.ajax({method:"POST",url:"/lessons/delete",data:pushToken({id:n}),success:function(a){a.status?($(t.currentTarget).parent().parent().remove(),$.Dialog.close()):$.Dialog.fail(e,a.message)}})}})},s=function(s){s.preventDefault();var o="Tantárgy hozzáadás";if(0===a.length)return $.Dialog.fail(o,'Tantárgyak felvétele előtt hozzá kell adnod tanárokat a <a href="/teachers">Tanárok</a> menüpontban!');var i=t.clone();i.find("[name=id]").remove(),i.find("[name=teacherid]").append(a),$.Dialog.request(o,i,"js_form","Mentés",function(t){$("#colorpicker").spectrum({change:function(t){$("#colorpicker").attr("value",t.toHexString())}}),t.on("submit",function(a){a.preventDefault();var s=t.serializeForm();$.Dialog.wait(o),$.ajax({method:"POST",url:"/lessons/add",data:s,success:function(a){if("string"==typeof a)return console.log(a),$(window).trigger("ajaxerror"),!1;if(a.status){var s=e.clone(),i=t.children();s.find(".tantargy").text(i.find("[name=name]").val()),s.find(".tanar").text(i.find("[name=teacherid]").find(":selected").text()),s.css("background-color",i.find("[name=color]").val()),s.attr("data-id",a.id),s.find(".js_lesson_edit").attr("href","#"+a.id),s.find(".js_lesson_delete").attr("href","#"+a.id);var l=$(".lessons");l.append(s);var c=$(".new").detach();l.sortChildren(".tantargy",!1),l.append(c),s.find(".js_lesson_edit").on("click",n),s.find(".js_lesson_delete").on("click",r),$.Dialog.close()}else $.Dialog.fail(o,a.message)}})})})};$(".js_lesson_add").on("click",s),$(".js_lesson_edit").on("click",n),$(".js_lesson_delete").on("click",r)});
//# sourceMappingURL=lessons.min.js.map
