$(function(){var e="Tanárok és tantárgyak lekérése",t=$("table tbody td"),a={},n=_USRGRP;if($("#select_tt").change(function(){window.location.href="/timetables/week/"+this.value}),"user"==n||"editor"==n)return void $("tr td").addClass("notAdmin");$.ajax({method:"POST",url:"/timetables/getoptions",success:function(n){if("string"==typeof n)return console.log(n)===$(window).trigger("ajaxerror");if(n.status){var o=$(document.createElement("div")),i=$(document.createElement("div")),r=n.lessons&&n.lessons.length;r&&$.each(n.lessons,function(e,t){o.append($(document.createElement("option")).attr("value",t.id).attr("data-name",t.name).text(t.name+" ("+t.teacher+")"))}),i.append($(document.createElement("option")).attr("value","0").text("Teljes o.")),$.each(n.groups,function(e,t){i.append($(document.createElement("option")).attr("value",t.id).text(t.name))}),$.extend($.fn.powerTip.defaults,{placement:"se",mouseOnToPopup:!0,smartPlacement:!0,manual:!0});var l=$("#form-template").children();l.find(".groups").html(i.children().clone());var d=l.find(".lessons");r?d.html(o.children().clone()):d.attr("disabled",!0).html("<option disabled>(nincs hozzáadva tantárgy)</option>"),l.on("submit",function(e){e.preventDefault();var t=$(this),n=t.parent().attr("id").split("-").slice(1),o=parseInt(n[0]),i=parseInt(n[1]),r=$(".timet tbody tr").eq(i).children().eq(o),l=t.find("select"),d=l.filter("[name=groups]"),c=l.filter("[name=lessons]");if(c.is("[disabled]"))return $.Dialog.fail("Óra hozzáadása",'Nem található tantárgy az adatbázisban!<br>A folytatáshoz adj hozzá legalább egy tantárgyat a <a href="/lessons">Tantárgyak</a> menüpontban!');var p={group:d.val(),tantargy:c.val(),lesson:i+1,day:o};s.add.push(p),r.removeClass("empty"),r.hasClass("editing")&&(r.removeClass("editing"),$.powerTip.hide());var u=c.find("option:selected").attr("data-name"),m="#E1E4FA",g="",f=d.find("option:selected").text();$.each(a.lessons,function(e,t){u==t.name&&(m=t.color)}),"Teljes o."!=f&&(g=" ("+f+")"),r.append("<span class='lesson' style='background: "+m+"'>"+u+g+"<span class='del typcn typcn-times' data-ttid='#"+p.tantargy+"'></span></span>")}),t.each(function(){var e=$(this).find(".add"),t=e.parent(),a="add-"+t.index()+"-"+t.parent().index();e.data("powertipjq",l).powerTip({popupId:a}),$(".tooltips, #"+a).off("mouseenter mouseleave")}),a=n}else $.Dialog.fail(e)}});var s={"delete":[],add:[],week:""};t.on("click",function(e){e.preventDefault(),e.stopPropagation();var a=$(this),n=a.hasClass("editing");n||t.removeClass("editing"),a[(n?"remove":"add")+"Class"]("editing"),n||(a.find(".add").removeClass("typcn-minus").addClass("typcn-plus"),$.powerTip.hide())}).find(".add").on("click",function(e){e.stopPropagation();var t=$(this);return t.parent().hasClass("editing")?(t.hasClass("typcn-plus")?t.powerTip("show"):$.powerTip.hide(),void t.toggleClass("typcn-plus typcn-minus")):t.parent().trigger("click")}),$(document).on("click",function(e){var a=$(e.target);0===$(e.target).closest('[id^="add-"]').length&&0===a.closest(".lesson-field").length&&(t.removeClass("editing"),$.powerTip.hide())}),t.on("click",".del",function(){var e=$(this),t=e.attr("data-ttid"),a=e.parent(),n=a.parent();if("#"!=t.substring(0,1))s["delete"].push({id:t});else{var o=n.index(),i=n.parent().index()+1,r=!1,l=t.substring(1);if($.each(s.add,function(e,t){o==t.day&&i==t.lesson&&l==t.tantargy&&(r=e)}),r!==!1){var d=[];$.each(s.add,function(e,t){r!=e&&d.push(t)}),s.add=d}}2==n.children().length&&n.addClass("empty"),a.remove()});var o=function(){var e="Órarend mentése";s.week=$(".week").text(),$.Dialog.wait(e),$.ajax({method:"POST",url:"/timetables/save",data:s,success:function(t){return"string"==typeof t?console.log(t)===$(window).trigger("ajaxerror"):t.status?($.Dialog.success(e,t.message),void setTimeout(function(){location.reload()},2500)):$.Dialog.fail(e,t.message)}})};$(".sendbtn").on("click",function(){return 0==s["delete"].length?o():void $.Dialog.confirm("Órarend mentése","Arra készülsz, hogy mented az órarend változtatásait, köztük számos bejegyzés törlését.<br>Ezzel a törölt bejegyzésekhez tartozó adatok is elvesznek.<br>Biztos vagy benne, hogy végrehajtod a változtatásokat?",["Változtatások mentése","Visszalépés"],function(e){e&&o()})})});
//# sourceMappingURL=tt-edit.min.js.map
