$(function(){function e(e){var t=[];return e.isFullDay&&t.push("Egész napos"),e.global&&t.push("Globális esemény"),$.mk("tr").append($.mk("td").text(e.id),$.mk("td").text(e.title),$.mk("td").html(e.start),$.mk("td").text(e.end),$.mk("td").text(t.length?t.join(", "):" "),$.mk("td").attr("class","actions").append(l.clone(!0,!0),o.clone(!0,!0)))}$("#js_hideShowFilter").on("click",function(){var e=$(this),t=$("#filterFormContainer");e.toggleClass("typcn-arrow-up-thick typcn-arrow-down-thick hide show"),t[e.hasClass("hide")?"show":"hide"](),e.text(e.hasClass("hide")?"Szűrőpanel összecsukása":"Szűrőpanel kinyitása"),e.blur()});var t=!0,n={startOfWeek:"monday",separator:" ~ ",autoClose:!1,language:"hu"},a={};$.fn.drpConfigure=function(){var e=this,a=$("#dateRangePicker"),s=e.find("input[name=isFullDay]");return s.on("change",function(){t=!this.checked,"undefined"!=typeof a.data("dateRangePicker")&&a.data("dateRangePicker").destroy(),a.dateRangePicker($.extend({format:"YYYY.MM.DD."+(t?" HH:mm":""),time:{enabled:t}},n)),a.triggerHandler("change")}).triggerHandler("change"),this};var s=$("#resultContainer"),i=$("#filterForm"),r=$("<form id='js_form'>							<label><span>Esemény címe</span><input type='text' name='title' required></label>							<label><span>Időtartam</span><input type='text' name='interval' id='dateRangePicker' required></label>	                        <label><input type='checkbox' name='isFullDay' value='1'> Egész napos esemény</label>	                        <label><input type='checkbox' name='isGlobal' value='1'> Globális esemény</label>							<label><span>Osztály</span><select name='classid' required></select></label>							<label><span>Esemény rövid leírása</span><textarea name='description' required></textarea></label>						</form>"),l=$.mk("button").attr("class","btn typcn typcn-pencil").text("Szerkesztés").on("click",function(e){e.preventDefault();var n=$(this).parents("tr"),a=n.children().first().text().trim();$.Dialog.wait("Esemény szerkesztése","Esemény adatainak lekérése"),$.post("/system.events/get",pushToken({id:a}),function(e){if("string"==typeof e)return console.log(e),$(window).trigger("ajaxerror"),!1;if(!e.status)return $.Dialog.fail(!1,e.message);var n=r.clone(!0,!0),s=n.find("select[name=classid]");t=1!=e.isFullDay,n.find("input[name=isFullDay]").attr("checked",!t),n.find("input[name=isGlobal]").attr("checked",Boolean(e.global)).triggerHandler("change"),n.find("input[name=interval]").val(e.start+" ~ "+e.end),n.find("input[name=title]").val(e.title),n.find("textarea[name=description]").text(e.description),s.val(e.classid),$.Dialog.request(!1,n,"js_form","Módosítások mentése",function(){n.drpConfigure().on("submit",function(e){e.preventDefault();var t=pushToken(n.serializeForm());t.id=a,$.Dialog.wait(!1,"Módosítások mentése"),$.post("/system.events/edit",t,function(e){return"string"==typeof e?(console.log(e),$(window).trigger("ajaxerror"),!1):e.status?void i.triggerHandler("submit"):$.Dialog.fail(!1,e.message)})})})})}),o=$.mk("button").attr("class","btn typcn typcn-trash").text("Törlés").on("click",function(e){e.preventDefault();var t=$(this).parents("tr");$.Dialog.confirm("Esemény törlése","Valóbaln törölni szeretnéd ezt az eseményt?",function(e){if(e){var n=t.children().first().text().trim();$.Dialog.wait("Esemény törlése"),$.post("/system.events/delete",pushToken({id:n}),function(e){return"string"==typeof e?(console.log(e),$(window).trigger("ajaxerror"),!1):e.status?(t.remove(),void $.Dialog.close()):$.Dialog.fail(!1,e.message)})}})});$.each(window.classes,function(e,t){"undefined"==typeof a[t.school]&&(a[t.school]=$.mk("optgroup").attr("label",t.school)),a[t.school].append($.mk("option").attr("value",t.id).text(t.school+" "+t.name))});var d=r.find("select[name=classid]"),c=$("#classid_selector");$.each(a,function(e,t){d.append(t.clone()),c.append(t.clone())}),r.find("input[name=isGlobal]").on("change",function(){$(this).parents("form").find("select[name=classid]").attr("disabled",this.checked)}),i.on("submit",function(t){t.preventDefault(),$.Dialog.wait(),$.post("/system.events/filter",$(this).serializeForm(),function(t){if("string"==typeof t)return console.log(t),$(window).trigger("ajaxerror"),!1;if(!t.status)return $.Dialog.fail(!1,t.message);var n=$.mk("table").attr("class","resultTable").append("<thead><tr><th>"+["ID","Cím","Kezdet","Befejezés","Tulajdonságok","Kezelés"].join("</th><th>")+"</th></tr></thead>"),a=$.mk("tbody");t.events&&$.each(t.events,function(t,n){a.append(e(n))}),s.empty().append("<h3>A lekérdezés eredménye: "+t.events.length+" esemény</h3>",n.append(a)),$.Dialog.close()})}),$("#js_addEvent").on("click",function(e){e.preventDefault();var t="Esemény hozzáadása",n=r.clone(!0,!0);$.Dialog.request(t,n,"js_form","Mentés",function(){n.drpConfigure().on("submit",function(e){e.preventDefault();var a=n.serializeForm();$.Dialog.wait(t),$.post("/system.events/add",a,function(e){return"string"==typeof e?(console.log(e),$(window).trigger("ajaxerror"),!1):e.status?void(s.is(":not(:empty)")?i.triggerHandler("submit"):$.Dialog.close()):$.Dialog.fail(t,e.message)})})})})});
//# sourceMappingURL=system.events.min.js.map
