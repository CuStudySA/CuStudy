$(function(){$("#js_hideShowFilter").on("click",function(){var e=$(this),t=$("#filterFormContainer");e.toggleClass("typcn-arrow-up-thick typcn-arrow-down-thick hide show"),t[e.hasClass("hide")?"show":"hide"](),e.text(e.hasClass("hide")?"Szűrőpanel összecsukása":"Szűrőpanel kinyitása"),e.blur()}),$("#filterForm").on("submit",function(e){e.preventDefault(),$.Dialog.wait(),$.ajax({method:"POST",url:"/system.users/filter",data:$("#filterForm").serializeForm(),success:function(e){return"string"==typeof e?(console.log(e),$(window).trigger("ajaxerror"),!1):void(e.status?($("#resultContainer").empty().append(e.html),$.Dialog.close(),$(".js_filterUsers").blur()):$.Dialog.fail(title,e.message))}})});var e=$("<form id='js_form'>						<p>Felhasználónév: <input type='text' name='username' placeholder='Felhasználónév' required></p>						<p>E-mail cím: <input type='text' name='email' placeholder='name@domain.tld' required></p>						<p>Teljes név: <input type='text' name='name' placeholder='Vezetéknév Keresztnév' required></p>						<input type='hidden' name='id' value=''>				</form>"),t=$("<form id='js_form'>							<p>Milyen műveletet szeretne végrehajtani?</p>							<label style='text-align:left'><input type='radio' name='action' value='edit' required checked> <strong>Szerkesztés</strong></label>							<label style='text-align:left'><input type='radio' name='action' value='delete' required id='roleDelete'> <strong>Törlés</strong></label>														<p>Kérem válassza ki a szerkeszteni vagy törölni kívánt szerepkört:</p>							</form>	"),a=$("<form id='js_form_edit'>							<p>Jogosultság: 								<select name='role'>									<option value='visitor' selected>Ált. felhasználó</option>									<option value='editor'>Szerkesztő</option>									<option value='admin'>Csoport adminisztrátor</option>								</select></p>								<input type='hidden' name='id'>							</form>");$("#js_editUserInfos").on("click",function(t){t.preventDefault();var a=$(t.currentTarget).attr("data-id"),r="Felhasználó alapadatainak szerkesztése";$.Dialog.wait(r,"Alapadatok lekérdezése..."),$.ajax({method:"POST",url:"/system.users/get/userInfos",data:pushToken({id:a}),success:function(t){if("string"==typeof t)return console.log(t),$(window).trigger("ajaxerror"),!1;if(t.status){var s=e.clone();s.find("[name=name]").attr("value",t.name),s.find("[name=username]").attr("value",t.username),s.find("[name=email]").attr("value",t.email),s.find("[name=id]").attr("value",a),$.Dialog.request(r,s,"js_form","Mentés",function(){var e=$("#js_form");e.on("submit",function(t){t.preventDefault(),$.Dialog.wait(r),$.ajax({method:"POST",url:"/system.users/editBasicInfos",data:e.serializeForm(),success:function(e){return"string"==typeof e?(console.log(e),$(window).trigger("ajaxerror"),!1):void(e.status?($.Dialog.success(r,e.message),setTimeout(function(){window.location.reload()},1500)):$.Dialog.fail(r,e.message))}})})})}else $.Dialog.fail(r,t.message)}})}),$("#js_editRoles").on("click",function(e){e.preventDefault();var r=$(e.currentTarget).attr("data-id"),s="Felhasználó szerepköreinek lekérdezése";$.Dialog.wait(s,"Az elérhető szerepkörök lekérdezése folyamatban..."),$.ajax({method:"POST",url:"/system.users/get/roles",data:pushToken({id:r}),success:function(e){if("string"==typeof e)return console.log(e),$(window).trigger("ajaxerror"),!1;if(e.status){var i=$('<label style="text-align:left"><input type="radio" name="role" required> <b class="school"></b>: <span class="role"></span></label>'),o=0,n=t.clone(),l=e.roles;if(0==l.length)return $.Dialog.fail(s,"Nincs szerkeszthető vagy törölhető szerepkör!");for(o=0;o<l.length;o++){var u=i.clone(),d=l[o];u.find("input").attr("value",d.id),u.find(".school").text(d.school),u.find(".role").text(d.role),n.filter("form").append(u)}$.Dialog.request(s,n,"js_form","Művelet végrehajtása",function(){var e=$("#js_form");e.on("submit",function(t){t.preventDefault(),e.find("input").attr("disabled",!0);var i=e.find(":checked").filter("[name=role]");return 0==i.length?$.Dialog.fail(s,"A művelet nem folytatható, mert nincs kiválasztott szerepkör!"):void(e.find("#roleDelete").prop("checked")?$.Dialog.confirm(s,"A kiválasztott szerepkör törlésére készül! Folytatja a műveletet?",["Szerepkör törlése","Visszalépés"],function(e){$.ajax({method:"POST",url:"/system.users/deleteRole",data:pushToken({id:i.attr("value"),userId:r}),success:function(e){return"string"==typeof e?(console.log(e),$(window).trigger("ajaxerror"),!1):void(e.status?($.Dialog.success(s,e.message),setTimeout(function(){window.location.reload()},1500)):$.Dialog.fail(s,e.message))}})}):($.Dialog.wait(s,"Szerepkör adatainak lekérdezése..."),$.ajax({method:"POST",url:"/system.users/get/role",data:pushToken({id:i.attr("value")}),success:function(e){if("string"==typeof e)return console.log(e),$(window).trigger("ajaxerror"),!1;if(e.status){var t=a.clone();t.find("[name=role]").children("option[value="+e.role+"]").attr("selected",!0),t.find("[name=id]").attr("value",i.attr("value")),$.Dialog.request(s,t,"js_form_edit","Művelet végrehajtása",function(){var e=$("#js_form_edit");e.on("submit",function(t){t.preventDefault(),$.Dialog.wait(s,"Módosítások mentése..."),$.ajax({method:"POST",url:"/system.users/editRole",data:e.serializeForm(),success:function(e){return"string"==typeof e?(console.log(e),$(window).trigger("ajaxerror"),!1):void(e.status?($.Dialog.success(s,e.message),setTimeout(function(){window.location.reload()},1e3)):$.Dialog.fail(s,e.message))}})})})}else $.Dialog.fail(s,e.message)}})))})})}}})})});
//# sourceMappingURL=system.users.min.js.map
