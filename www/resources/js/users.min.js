"use strict";$(function(){var t,e=$("<form id='js_form'>\t\t\t\t\t\t<p>Felhasználónév: <input type='text' name='username' placeholder='Felhasználónév' required disabled></p>\t\t\t\t\t\t<p>E-mail cím: <input type='text' name='email' placeholder='email@provider.mail' required disabled></p>\t\t\t\t\t\t<p>Jogosultság: \t\t\t\t\t\t\t<select name='role'>\t\t\t\t\t\t\t\t<option value='visitor' selected>Ált. felhasználó</option>\t\t\t\t\t\t\t\t<option value='editor'>Szerkesztő</option>\t\t\t\t\t\t\t\t<option value='admin'>Csoport adminisztrátor</option>\t\t\t\t\t\t\t</select></p>\t\t\t\t\t\t<input type='hidden' name='id' value=''>\t\t\t\t</form>"),a=$("<li>\t\t\t\t\t\t\t<div class='top clearfix'>\t\t\t\t\t\t\t\t<div class='left'>\t\t\t\t\t\t\t\t\t<span class='typcn typcn-user'></span>\t\t\t\t\t\t\t\t\t<span class='id'></span>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t<div class='right'>\t\t\t\t\t\t\t\t\t<span class='vnev'></span> <span class='knev'></span>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div class='bottom'>\t\t\t\t\t\t\t\t<a class='typcn typcn-edit js_user_edit' href='' title='Módosítás'></a>\t\t\t\t\t\t\t\t<a class='typcn typcn-media-eject js_user_eject' href='' title='Felhasználó osztálybeli szerepkörének törlése'></a>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</li>"),n=$(".invite_form").detach().css("display","block"),l=function(e){e.preventDefault(),t instanceof jQuery&&t.remove(),t=n.clone(),$("main").append(t),$(document.body).animate({scrollTop:t.offset().top-10},500),$(".addlesson").click(function(){var t=$("[name=name]").val(),e=$("[name=email]").val(),a=$(".l_l_utag"),n=!1,l="Felhasználók meghívása",s=new RegExp($("[name=name]").attr("pattern")),i=new RegExp($("[name=email]").attr("pattern"));return s.test(t)?i.test(e)?($.each(a.children(),function(t,a){var s=$(a).attr("data-email");if(s==e)return $.Dialog.fail(l,"Már hozzáadtad ezt a felhasználót!"),n=!0,$("[name=name]").val(""),void $("[name=email]").val("")}),void(n||($(".l_l_utag").append('<li data-email="'+e+'" data-name="'+t+'"><b>'+t+"</b> ("+e+')<span class="typcn typcn-times l_l_deleteopt"></span></li>'),$(".l_l_empty").remove(),$("[name=name]").val(""),$("[name=email]").val(""),$(".l_l_deleteopt").on("click",function(){var t=$(this).parent(),e=$(".l_l_utag");t.remove(),0==e.children().size()&&e.append('<li class="l_l_empty">(nincs)</li>')})))):void $.Dialog.fail(l,"Az e-mail cím formátuma nem megfelelő! Kérjük írjon be egy helyes e-mail címet!"):void $.Dialog.fail(l,"A felhasználó nevének formátuma nem megfelelő! Kérjük írjon be egy helyes nevet!")});var l=[],r=!1;$(".a_t_f_sendButton").click(function(){if(r!==!0){r=!0;var e=$(".l_l_utag"),n="Felhasználók meghívása",o=$(".customers");$.each(e.children(),function(t,e){if(!$(e).hasClass("l_l_empty")){var a=$(e).attr("data-name"),n=$(e).attr("data-email");l.push({name:a,email:n})}}),$.Dialog.wait(n),$.ajax({method:"POST",url:"/users/invite",data:pushToken({invitations:l}),success:function(e){if("string"==typeof e)return console.log(e),$(window).trigger("ajaxerror"),!1;if(e.status){t.remove(),t=void 0;for(var l=0;l<e.enrolledUsers.length;l++){var r=e.enrolledUsers[l],c=a.clone(),d=r.name.split(" ");c.find(".vnev").text(d.slice(0,1).toString()),c.find(".knev").text(d.slice(1).join(" ")),c.attr("data-id",r.id),c.find(".id").text("#"+r.id),c.find(".js_user_edit").attr("href","#"+r.id),c.find(".js_user_eject").attr("href","#"+r.id),o.append(c);var m=$(".new").detach();o.sortChildren(".vnev",!1),o.append(m),c.find(".js_user_edit").on("click",s),c.find(".js_user_eject").on("click",i)}$.Dialog.success(n,e.message,!0)}else $.Dialog.fail(n,e.message)},complete:function(){r=!1}})}})};$(".js_invite").on("click",l);var s=function(t){t.preventDefault();var a="Felhasználó szerkesztése",n=$(t.currentTarget).attr("href").substring(1);$.ajax({method:"POST",url:"/users/get",data:pushToken({id:n}),success:function(t){if("string"==typeof t)return console.log(t),$(window).trigger("ajaxerror"),!1;var l=e.clone();l.find("[name=username]").attr("value",t.username),l.find("[name=email]").attr("value",t.email),l.find("[name=role]").children("option[value="+t.role+"]").attr("selected",!0),l.find("[name=id]").attr("value",n),$.Dialog.request(a,l.prop("outerHTML"),"js_form","Mentés",function(){var t=$("#js_form");t.on("submit",function(e){e.preventDefault();var n=t.serializeForm();$.Dialog.wait(a),$.ajax({method:"POST",url:"/users/edit",data:n,success:function(t){return"string"==typeof t?(console.log(t),$(window).trigger("ajaxerror"),!1):void(t.status?$.Dialog.close():$.Dialog.fail(a,t.message))}})})})}})};$(".js_user_edit").on("click",s);var i=function(t){t.preventDefault();var e="Felhasználó szerepkörének leválasztása";$.Dialog.confirm(e,"Arra készülsz, hogy törlöd a kiválasztott felhasználó osztáybeli szerepkörét, azaz törlöd a felhasználót az osztályból! Biztosan folytatod?",["Felhasználó törlése az osztályból","Visszalépés"],function(a){if(a){var n=$(t.currentTarget).attr("href").substring(1);$.Dialog.wait(e),$.ajax({method:"POST",url:"/users/eject",data:pushToken({id:n}),success:function(a){a.status?($(t.currentTarget).parent().parent().remove(),$.Dialog.close()):$.Dialog.fail(e,a.message)}})}})};$(".js_user_eject").on("click",i)});
//# sourceMappingURL=users.min.js.map
