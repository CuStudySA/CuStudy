$(function(){var e,a=$("<form id='js_form'>						<p>Felhasználónév: <input type='text' name='username' placeholder='Felhasználónév' required disabled></p>						<p>E-mail cím: <input type='text' name='email' placeholder='email@provider.mail' required disabled></p>						<p>Jogosultság: 							<select name='role'>								<option value='visitor' selected>Ált. felhasználó</option>								<option value='editor'>Szerkesztő</option>								<option value='admin'>Csoport adminisztrátor</option>							</select></p>						<input type='hidden' name='id' value=''>				</form>"),t=$("<li>							<div class='top clearfix'>								<div class='left'>									<span class='typcn typcn-user'></span>									<span class='id'></span>								</div>								<div class='right'>									<span class='vnev'></span> <span class='knev'></span>								</div>							</div>							<div class='bottom'>								<a class='typcn typcn-pencil js_user_edit' href='' title='Módosítás'></a>								<a class='typcn typcn-media-eject js_user_eject' href='' title='Felhasználó osztálybeli szerepkörének törlése'></a>							</div>						</li>"),n=$(".invite_form").detach().css("display","block"),l=function(a){a.preventDefault(),e instanceof jQuery&&e.remove(),e=n.clone(),$("main").append(e),$(document.body).animate({scrollTop:e.offset().top-10},500),$(".addlesson").click(function(){var e=$("[name=name]").val(),a=$("[name=email]").val(),t=$(".l_l_utag"),n=!1,l="Felhasználók meghívása",s=new RegExp($("[name=name]").attr("pattern")),i=new RegExp($("[name=email]").attr("pattern"));return s.test(e)?i.test(a)?($.each(t.children(),function(e,t){var s=$(t).attr("data-email");return s==a?($.Dialog.fail(l,"Már hozzáadtad ezt a felhasználót!"),n=!0,$("[name=name]").val(""),void $("[name=email]").val("")):void 0}),void(n||($(".l_l_utag").append('<li data-email="'+a+'" data-name="'+e+'"><b>'+e+"</b> ("+a+')<span class="typcn typcn-times l_l_deleteopt"></span></li>'),$(".l_l_empty").remove(),$("[name=name]").val(""),$("[name=email]").val(""),$(".l_l_deleteopt").on("click",function(){var e=$(this).parent(),a=$(".l_l_utag");e.remove(),0==a.children().size()&&a.append('<li class="l_l_empty">(nincs)</li>')})))):void $.Dialog.fail(l,"Az e-mail cím formátuma nem megfelelő! Kérjük írjon be egy helyes e-mail címet!"):void $.Dialog.fail(l,"A felhasználó nevének formátuma nem megfelelő! Kérjük írjon be egy helyes nevet!")});var l=[],r=!1;$(".a_t_f_sendButton").click(function(){if(r!==!0){r=!0;var a=$(".l_l_utag"),n="Felhasználók meghívása",o=$(".customers");$.each(a.children(),function(e,a){if(!$(a).hasClass("l_l_empty")){var t=$(a).attr("data-name"),n=$(a).attr("data-email");l.push({name:t,email:n})}}),$.Dialog.wait(n),$.ajax({method:"POST",url:"/users/invite",data:pushToken({invitations:l}),success:function(a){if("string"==typeof a)return console.log(a),$(window).trigger("ajaxerror"),!1;if(a.status){e.remove(),e=void 0;for(var l=0;l<a.enrolledUsers.length;l++){var r=a.enrolledUsers[l],c=t.clone(),d=r.name.split(" ");c.find(".vnev").text(d.slice(0,1).toString()),c.find(".knev").text(d.slice(1).join(" ")),c.attr("data-id",r.id),c.find(".id").text("#"+r.id),c.find(".js_user_edit").attr("href","#"+r.id),c.find(".js_user_eject").attr("href","#"+r.id),o.append(c);var m=$(".new").detach();o.sortChildren(".vnev",!1),o.append(m),c.find(".js_user_edit").on("click",s),c.find(".js_user_eject").on("click",i)}$.Dialog.success(n,a.message,!0)}else $.Dialog.fail(n,a.message)},complete:function(){r=!1}})}})};$(".js_invite").on("click",l);var s=function(e){e.preventDefault();var t="Felhasználó szerkesztése",n=$(e.currentTarget).attr("href").substring(1);$.ajax({method:"POST",url:"/users/get",data:pushToken({id:n}),success:function(e){if("string"==typeof e)return console.log(e),$(window).trigger("ajaxerror"),!1;var l=a.clone();l.find("[name=username]").attr("value",e.username),l.find("[name=email]").attr("value",e.email),l.find("[name=role]").children("option[value="+e.role+"]").attr("selected",!0),l.find("[name=id]").attr("value",n),$.Dialog.request(t,l.prop("outerHTML"),"js_form","Mentés",function(){var e=$("#js_form");e.on("submit",function(a){a.preventDefault(),$.Dialog.wait(t),$.ajax({method:"POST",url:"/users/edit",data:e.serializeForm(),success:function(e){return"string"==typeof e?(console.log(e),$(window).trigger("ajaxerror"),!1):void(e.status?$.Dialog.close():$.Dialog.fail(t,e.message))}})})})}})};$(".js_user_edit").on("click",s);var i=function(e){e.preventDefault();var a="Felhasználó szerepkörének leválasztása";$.Dialog.confirm(a,"Arra készülsz, hogy törlöd a kiválasztott felhasználó osztáybeli szerepkörét, azaz törlöd a felhasználót az osztályból! Biztosan folytatod?",["Felhasználó törlése az osztályból","Visszalépés"],function(t){if(t){var n=$(e.currentTarget).attr("href").substring(1);$.Dialog.wait(a),$.ajax({method:"POST",url:"/users/eject",data:pushToken({id:n}),success:function(t){t.status?($(e.currentTarget).parent().parent().remove(),$.Dialog.close()):$.Dialog.fail(a,t.message)}})}})};$(".js_user_eject").on("click",i)});
//# sourceMappingURL=users.min.js.map
