"use strict";$(function(){var t,e=$("<form id='js_form'>\n\t\t\t\t\t\t<p>Felhasználónév: <input type='text' name='username' placeholder='Felhasználónév' required disabled></p>\n\t\t\t\t\t\t<p>E-mail cím: <input type='text' name='email' placeholder='email@provider.mail' required disabled></p>\n\t\t\t\t\t\t<p>Jogosultság: \n\t\t\t\t\t\t\t<select name='role'>\n\t\t\t\t\t\t\t\t<option value='visitor' selected>Ált. felhasználó</option>\n\t\t\t\t\t\t\t\t<option value='editor'>Szerkesztő</option>\n\t\t\t\t\t\t\t\t<option value='admin'>Csoport adminisztrátor</option>\n\t\t\t\t\t\t\t\t<!--<option value='teacher'>Tanár</option>-->\n\t\t\t\t\t\t\t</select></p>\n\t\t\t\t\t\t<input type='hidden' name='id' value=''>\n\t\t\t\t</form>"),a=$("<li>\n\t\t\t\t\t\t\t<div class='top clearfix'>\n\t\t\t\t\t\t\t\t<div class='left'>\n\t\t\t\t\t\t\t\t\t<span class='typcn typcn-user'></span>\n\t\t\t\t\t\t\t\t\t<span class='id'></span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class='right'>\n\t\t\t\t\t\t\t\t\t<span class='vnev'></span> <span class='knev'></span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class='bottom'>\n\t\t\t\t\t\t\t\t<a class='typcn typcn-edit js_user_edit' href='' title='Módosítás'></a>\n\t\t\t\t\t\t\t\t<a class='typcn typcn-media-eject js_user_eject' href='' title='Felhasználó osztálybeli szerepkörének törlése'></a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</li>"),n=$(".invite_form").detach().css("display","block"),l=function(e){e.preventDefault(),t instanceof jQuery&&t.remove(),t=n.clone(),$("main").append(t),$(document.body).animate({scrollTop:t.offset().top-10},500),$(".addlesson").click(function(){var t=$("[name=name]"),e=t.val(),a=$("[name=email]"),n=a.val(),l=$(".l_l_utag"),s=!1,i="Felhasználók meghívása",r=new RegExp(t.attr("pattern")),o=new RegExp(a.attr("pattern"));return r.test(e)?o.test(n)?($.each(l.children(),function(t,e){var n=$(e).attr("data-email");if(n==a)return $.Dialog.fail(i,"Már hozzáadtad ezt a felhasználót!"),s=!0,$("[name=name]").val(""),void $("[name=email]").val("")}),void(s||(l.append('<li data-email="'+n+'" data-name="'+e+'"><b>'+e+"</b> ("+n+')<span class="typcn typcn-times l_l_deleteopt"></span></li>'),$(".l_l_empty").remove(),t.val(""),a.val(""),$(".l_l_deleteopt").on("click",function(){var t=$(this).parent(),e=$(".l_l_utag");t.remove(),0==e.children().size()&&e.append('<li class="l_l_empty">(nincs)</li>')})))):void $.Dialog.fail(i,"Az e-mail cím formátuma nem megfelelő! Kérjük írjon be egy helyes e-mail címet!"):void $.Dialog.fail(i,"A felhasználó nevének formátuma nem megfelelő! Kérjük írjon be egy helyes nevet!")});var l=[],r=!1;$(".a_t_f_sendButton").click(function(){if(r!==!0){r=!0;var e=$(".l_l_utag"),n="Felhasználók meghívása",o=$(".customers");$.each(e.children(),function(t,e){if(!$(e).hasClass("l_l_empty")){var a=$(e).attr("data-name"),n=$(e).attr("data-email");l.push({name:a,email:n})}}),$.Dialog.wait(n),$.ajax({method:"POST",url:"/users/invite",data:{invitations:l},success:function(e){if("string"==typeof e)return console.log(e),$(window).trigger("ajaxerror"),!1;if(e.status){t.remove(),t=void 0;for(var l=0;l<e.enrolledUsers.length;l++){var r=e.enrolledUsers[l],c=a.clone(),d=r.name.split(" ");c.find(".vnev").text(d.slice(0,1).toString()),c.find(".knev").text(d.slice(1).join(" ")),c.attr("data-id",r.id),c.find(".id").text("#"+r.id),c.find(".js_user_edit").attr("href","#"+r.id),c.find(".js_user_eject").attr("href","#"+r.id),o.append(c);var u=$(".new").detach();o.sortChildren(".vnev",!1),o.append(u),c.find(".js_user_edit").on("click",s),c.find(".js_user_eject").on("click",i)}$.Dialog.success(n,e.message,!0)}else $.Dialog.fail(n,e.message)},complete:function(){r=!1}})}})};$(".js_invite").on("click",l);var s=function(t){t.preventDefault();var a="Felhasználó szerkesztése",n=$(t.currentTarget).attr("href").substring(1);$.ajax({method:"POST",url:"/users/get",data:{id:n},success:function(t){if("string"==typeof t)return console.log(t),$(window).trigger("ajaxerror"),!1;var l=e.clone();l.find("[name=username]").attr("value",t.username),l.find("[name=email]").attr("value",t.email),l.find("[name=role]").children("option[value="+t.role+"]").attr("selected",!0),l.find("[name=id]").attr("value",n),$.Dialog.request(a,l.prop("outerHTML"),"js_form","Mentés",function(){var t=$("#js_form");t.on("submit",function(e){e.preventDefault();var n=t.serializeForm();$.Dialog.wait(a),$.ajax({method:"POST",url:"/users/edit",data:n,success:function(t){return"string"==typeof t?(console.log(t),$(window).trigger("ajaxerror"),!1):void(t.status?$.Dialog.close():$.Dialog.fail(a,t.message))}})})})}})};$(".js_user_edit").on("click",s);var i=function(t){t.preventDefault();var e="Felhasználó szerepkörének leválasztása";$.Dialog.confirm(e,"Arra készülsz, hogy törlöd a kiválasztott felhasználó osztáybeli szerepkörét, azaz törlöd a felhasználót az osztályból! Biztosan folytatod?",["Felhasználó törlése az osztályból","Visszalépés"],function(a){if(a){var n=$(t.currentTarget).attr("href").substring(1);$.Dialog.wait(e),$.ajax({method:"POST",url:"/users/eject",data:{id:n},success:function(a){a.status?($(t.currentTarget).parent().parent().remove(),$.Dialog.close()):$.Dialog.fail(e,a.message)}})}})};$(".js_user_eject").on("click",i)});
//# sourceMappingURL=users.js.map
