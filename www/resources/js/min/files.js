"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};$(function(){function e(e){var t=$(this),n=this.files[0],a=t.parent(),o=t.next(),i=$(".fileFormContainer");if("undefined"!=typeof n){if(o.show(),u(n)&&a.remove(),"undefined"!=typeof t.parent().prop("prevFiles"))return;o.find('input[name="fileTitle"]').val(e.target.value.split(/(\\|\/)/g).pop()).next().focus(),$(e.currentTarget).parent().prop("prevFiles",e.target.files),i.append(r.clone(!0,!0))}else a.remove()}function t(e){e.preventDefault();var t=$(".uploadFileForm");t.show(),$(document.body).animate({scrollTop:t.offset().top-10},500)}function n(e){e.preventDefault();var t=new FormData,n=$(".uploadContainer").find("input[type=file]"),a="Feltöltés folyamatban";$.Dialog.wait(a,"Kérjük, ne zárja be ezt az ablakot, a fájlok feltöltése folyamatban van"),$.each(n,function(e,n){var a=n.files[0];"undefined"!=typeof a&&t.append(e,a)});var o=$(".uploadContainer").find(".infoContainer");$.each(o,function(e,n){var a=$(n);if("none"!=a.css("display")){var o=a.find("[name=fileTitle]"),i=a.find("[name=fileDesc]");t.append(e+".title",o.val()),t.append(e+".desc",i.val())}}),t.append("JSSESSID",getToken()),$.ajax({method:"POST",url:"/files/uploadFiles",cache:!1,processData:!1,contentType:!1,data:t,success:function(e){return"object"!==("undefined"==typeof e?"undefined":_typeof(e))?(console.log(e),$(window).trigger("ajaxerror"),!1):($(".uploadFileForm").replaceWith(s),void(e.status?(f.html(e.filelist),$.Dialog.close(),"undefined"!=typeof e.storage&&i(e.storage)):$.Dialog.fail(a,e.message)))},error:function(){$.Dialog.fail(a,"A fájlok szerverre történő továbbítása sikertelenül zárult! Kérjük, próbálja újra!")}})}function a(e){e.preventDefault();var t=$(e.currentTarget).attr("href").substring(1),n="Dokumentum törlése";$.Dialog.confirm(n,"Arra készül, hogy törli a kiválasztott dokumentumot a szerverről. A művelet nem visszavonható! Folytatja?",["Végleges törlés","Mégse"],function(a){a&&($.Dialog.wait(n),$.ajax({method:"POST",url:"/files/delete",data:{id:t},success:function(t){return"object"!==("undefined"==typeof t?"undefined":_typeof(t))?(console.log(t),$(window).trigger("ajaxerror"),!1):void(t.status?($(e.currentTarget).parent().parent().remove(),$.Dialog.close(),"undefined"!=typeof t.storage&&i(t.storage)):$.Dialog.fail(n,t.message))}}))})}function o(e){e.preventDefault();var t=$(e.currentTarget).attr("href").substring(1),n="Dokumentum információk lekérése";$.Dialog.wait(n),$.ajax({method:"POST",url:"/files/getFileInfo",data:{id:t},success:function(e){return"object"!==("undefined"==typeof e?"undefined":_typeof(e))?(console.log(e),$(window).trigger("ajaxerror"),!1):void(e.status?$.Dialog.info(n,e.html):$.Dialog.fail(n,e.message))}})}function i(e){var t=e["Used%"];!isNaN(t)&&t>0?(0===c.length&&(c=$.mk("div").appendTo(d)),c.css("width",t+"%").attr("class","used "+(t>75?"high":"low"))):c.fadeOut(500,function(){c.remove()}),d.prev().html(function(){return this.innerHTML.replace(/^.*<br>/,e.Used+" ("+t+"%) felhasználva az osztály számára elérhető "+e.Available+"-ból.<br>")})}var r=$("\t\t<div class='uploadContainer'>\t\t\t<input type='file' class='uploadField' name='uploadField'>\t\t\t<div class='infoContainer' style='display: none;'>\t\t\t\t<input type='text' name='fileTitle' placeholder='Dokumentum címe' required autofocus='true'>\t\t\t\t<textarea name='fileDesc' placeholder='Dokumentum tartalma, leírása' required></textarea>\t\t\t</div>\t\t</div>"),l=$(".uploadFileForm").on("click",".js_uploadFiles",n),s=l.clone(!0,!0),f=$("ul.files").on("click",".js_file_add",t);$(".uploadField").add(r.find(".uploadField")).on("change",e);var u=function(e){var t=$(".uploadContainer").find("input[type=file]"),n=0;return $.each(t,function(t,a){var o=a.files[0];"undefined"!=typeof o&&e.name==o.name&&o.size==e.size&&n++}),n>1},d=$("#storage-use").find(".indicator"),c=d.children(".used");f.on("click",".js_delete",a).on("click",".js_more_info",o),f.on("click",".js_open_external_viewer",function(e){e.preventDefault();var t=$(e.currentTarget).attr("href").substring(1),n="Fájl megnyitása külső nézegetőben";$.Dialog.wait(n,"Hozzáférési azonosító lérehozása, várjunk..."),$.ajax({method:"POST",url:"/files/openExternalViewer",data:{id:t},success:function(e){return"object"!==("undefined"==typeof e?"undefined":_typeof(e))?(console.log(e),$(window).trigger("ajaxerror"),!1):void(e.status?window.location.href=e.url:$.Dialog.fail(n,e.message))}})})});
//# sourceMappingURL=files.js.map
