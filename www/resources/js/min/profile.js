"use strict";$(function(){displayError(),$("#dataform").on("submit",function(t){t.preventDefault();var a="Felhasználói adataim módosítása",e=$(this).serializeForm();$.Dialog.wait(a),$.ajax({method:"POST",url:"/profile/edit",data:e,success:function(t){return"string"==typeof t?(console.log(t),$(window).trigger("ajaxerror"),!1):void(t.status?($.Dialog.success(a,t.message,!0),$(".name").text($("[name=name]").val()),$(".email").text($("[name=email]").val())):$.Dialog.fail(a,t.message))}}),$("[name=oldpassword], [name=password], [name=verpasswd]").val("")});var t=$("#connect_s"),a=$("#connect");a.on("click",function(a){a.preventDefault();var e=t.val();return e?void $.Dialog.confirm("Fiókok összekapcsolása","A fiókjának összekapcsolásához át kell irányítanunk Önt a szolgáltatójának weboldalára.<br>A sikeres azonosítás után a rendszer visszairányítja. Folytatja?",["Tovább a szolgáltatóhoz","Visszalépés"],function(t){t&&($.Dialog.wait(!1,"Átirányítjuk"),window.location.href="/profile/connect/"+e)}):$.Dialog.fail("Fiókok összekapcsolása","Fiókjának összekapcsolásához először válasszon ki egy szolgáltatót!")}),function e(){$(".disconnect").off("click").on("click",function(e){e.preventDefault();var l="Fiókok leválasztása",o=$(this).closest(".conn-wrap"),i=o.find(".logo"),r=i.attr("title"),s=o.attr("data-prov");$.Dialog.confirm(l,"A kiválasztott szolgáltatóhoz kapcsolódó fiókot leválasztja a CuStudy fiókjáról, így az nem lesz látható a listában és nem lehet bejelentkezéshez használni. A művelet nem visszavonható! Folytatja?",["Leválasztás","Mégse"],function(e){e&&($.Dialog.wait(l),$.ajax({method:"POST",url:"/profile/unlink",data:{id:o.attr("data-id")},success:function(e){return"string"==typeof e?(console.log(e),$(window).trigger("ajaxerror"),!1):e.status?($.Dialog.close(),o.remove(),t.append($.mk("option").attr("value",s).text(r)).closest(".conn-wrap").show(),void a.attr("disabled",!1)):$.Dialog.fail(l,e.message)}}))})}),$(".activeToggle").off("click").on("click",function(t){t.preventDefault();var a=(this.className.indexOf("typcn-tick")!==-1?"":"de")+"activate",e=$.capitalize(a.replace(/ate$/,"").replace("c","k")+"álás"),l="Fiókkapcsolat "+e.toLowerCase()+"a",o="deactivate"===a?"A kiválaszott szolgáltatóval annak újra aktiválásáig nem tud majd bejelentkezni. Folytatja?":"A kiválaszott szolgáltató aktiválásával újra be tud majd jelentkezni vele. Folytatja?",i=$(this),r=$(this).closest(".conn-wrap");$.Dialog.confirm(l,o,[e,"Mégse"],function(t){t&&($.Dialog.wait(l),$.ajax({method:"POST",url:"/profile/"+a,data:{id:r.attr("data-id")},success:function(t){return"string"==typeof t?(console.log(t),$(window).trigger("ajaxerror"),!1):t.status?($.Dialog.close(),i.toggleClass("typcn-power typcn-tick").toggleHtml(["Aktiválás","Deaktiválás"]),void i.parent().prev().html(function(){return this.innerHTML.replace(/^(Ina|A)/,function(t){return"A"===t?"Ina":"A"})})):$.Dialog.fail(l,t.message)}}))})}),$(".makepicture").off("click").on("click",function(t){t.preventDefault();var a="Profilkép szolgáltató megváltoztatása",l=$(this).closest(".conn-wrap"),o=l.find(".logo").attr("title"),i=l.attr("data-prov");$.Dialog.confirm(a,"A profilkép szolgáltató módosításával megváltoztathatod, hogy melyik kép jelenjen meg az oldalon a neved mellett.<br>Átváltasz a(z) "+o+" szolgáltatónál használt profilképre?",["Váltás","Maradjon a régi"],function(t){t&&($.Dialog.wait(a),$.post("/profile/setavatarprovider",{provider:i},function(t){if("string"==typeof t)return console.log(t),$(window).trigger("ajaxerror"),!1;if(!t.status)return $.Dialog.fail(a,t.message);var o="undefined"==typeof i,r=l.parent(),s=r.children().last();r.children("[data-id]").remove(),$(t.connwraps).insertBefore(s),e(),s.find(".status").text(o?"Jelenlegi profilkép":"Nincs használatban").next().children(".makepicture").attr("disabled",o),$("#sidebar").find(".avatar img").attr("src",t.picture),$.Dialog.close()}))})});var l=function(t){t.preventDefault();var a=$(t.currentTarget).attr("data-id"),e="Szerepkör alapértelmezetté tétele";if("undefined"==typeof a)throw new Error('Nincs megadva "data-id" paraméter!');$.Dialog.wait(),$.ajax({method:"POST",url:"/profile/roles/changeDefault",data:{id:a},success:function(a){return"string"==typeof a?(console.log(a),$(window).trigger("ajaxerror"),!1):void(a.status?($(".js_changeDefault").prop("disabled",!1),$(t.currentTarget).prop("disabled",!0),$.Dialog.close()):$.Dialog.fail(e,a.message))}})};$(".js_changeDefault").on("click",l);var o=function(t){t.preventDefault();var a="Szerepkör leválasztása";if($(t.currentTarget).parent().find(".js_changeDefault").prop("disabled"))return $.Dialog.fail(a,"Az alapértelemeztt szerepkör leválasztása nem lehetséges! A leválasztás előtt jelöljön ki egy másik szerepkört alapértelmezettként!");var e=$(t.currentTarget).attr("data-id"),l=$("<p>Arra készül, hogy leválasztja a kiválasztott szerepkört a fiókjáról. Ez azt jelenti, hogy egy osztálybeli szerepkör leválasztása esetén nem lesz képes a továbbiakban hozzáférni az osztályhoz!<br>\t\t\t\t\t\t\tEz a művelet nem visszavonható, így kérem, erősítse meg szándékát a jelszava begépelésével!</p>\t\t\t\t\t\t\t<form id='js_form'>\t\t\t\t\t\t\t\t<p><strong>Jelenlegi jelszava:</strong> <input type='password' name='password' required placeholder='Jelenlegi jelszava\t\t\t\t\t\t\t\t'></p>\t\t\t\t\t\t\t\t<input type='hidden' name='id'>\t\t\t\t\t\t\t</form>");if("undefined"==typeof e)throw new Error('Nincs megadva "data-id" paraméter!');l.find("input[type=hidden]").attr("value",e),$.Dialog.request(a,l,"js_form","Leválasztás",function(t){t.on("submit",function(l){l.preventDefault();var o=t.serializeForm();$.Dialog.wait(),$.ajax({method:"POST",url:"/profile/roles/eject",data:o,success:function(t){if("string"==typeof t)return console.log(t),$(window).trigger("ajaxerror"),!1;if(t.status){if(1==t.reload)return window.location.reload();$(".conn-wrap[data-id="+e+"]").remove(),$.Dialog.close()}else $.Dialog.fail(a,t.message)}})})})};$(".js_eject").on("click",o)}()});
//# sourceMappingURL=profile.js.map
