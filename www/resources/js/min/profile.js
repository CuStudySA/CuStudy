"use strict";$(function(){displayError(),$("#dataform").on("submit",function(t){t.preventDefault();var a="Felhasználói adataim módosítása",e=$(this).serializeForm();$.Dialog.wait(a),$.ajax({method:"POST",url:"/profile/edit",data:e,success:function(t){return"string"==typeof t?(console.log(t),$(window).trigger("ajaxerror"),!1):void(t.status?($.Dialog.success(a,t.message,!0),$(".name").text($("[name=name]").val()),$(".email").text($("[name=email]").val())):$.Dialog.fail(a,t.message))}}),$("[name=oldpassword], [name=password], [name=verpasswd]").val("")});var t=$("#connect_s"),a=$("#connect");a.on("click",function(a){a.preventDefault();var e=t.val();return e?void $.Dialog.confirm("Fiókok összekapcsolása","A fiókjának összekapcsolásához át kell irányítanunk Önt a szolgáltatójának weboldalára.<br>A sikeres azonosítás után a rendszer visszairányítja. Folytatja?",["Tovább a szolgáltatóhoz","Visszalépés"],function(t){t&&($.Dialog.wait(!1,"Átirányítjuk"),window.location.href="/profile/connect/"+e)}):$.Dialog.fail("Fiókok összekapcsolása","Fiókjának összekapcsolásához először válasszon ki egy szolgáltatót!")}),function o(){$(".disconnect").off("click").on("click",function(e){e.preventDefault();var o="Fiókok leválasztása",s=$(this).closest(".conn-wrap"),l=s.find(".logo"),n=l.attr("title"),i=s.attr("data-prov");$.Dialog.confirm(o,"A kiválasztott szolgáltatóhoz kapcsolódó fiókot leválasztja a CuStudy fiókjáról, így az nem lesz látható a listában és nem lehet bejelentkezéshez használni. A művelet nem visszavonható! Folytatja?",["Leválasztás","Mégse"],function(e){e&&($.Dialog.wait(o),$.ajax({method:"POST",url:"/profile/unlink",data:{id:s.attr("data-id")},success:function(e){return"string"==typeof e?(console.log(e),$(window).trigger("ajaxerror"),!1):e.status?($.Dialog.close(),s.remove(),t.append($.mk("option").attr("value",i).text(n)).closest(".conn-wrap").show(),void a.attr("disabled",!1)):$.Dialog.fail(o,e.message)}}))})}),$(".activeToggle").off("click").on("click",function(t){t.preventDefault();var a=(this.className.indexOf("typcn-tick")!==-1?"":"de")+"activate",e=$.capitalize(a.replace(/ate$/,"").replace("c","k")+"álás"),o="Fiókkapcsolat "+e.toLowerCase()+"a",s="deactivate"===a?"A kiválaszott szolgáltatóval annak újra aktiválásáig nem tud majd bejelentkezni. Folytatja?":"A kiválaszott szolgáltató aktiválásával újra be tud majd jelentkezni vele. Folytatja?",l=$(this),n=$(this).closest(".conn-wrap");$.Dialog.confirm(o,s,[e,"Mégse"],function(t){t&&($.Dialog.wait(o),$.ajax({method:"POST",url:"/profile/"+a,data:{id:n.attr("data-id")},success:function(t){return"string"==typeof t?(console.log(t),$(window).trigger("ajaxerror"),!1):t.status?($.Dialog.close(),l.toggleClass("typcn-power typcn-tick").toggleHtml(["Aktiválás","Deaktiválás"]),void l.parent().prev().html(function(){return this.innerHTML.replace(/^(Ina|A)/,function(t){return"A"===t?"Ina":"A"})})):$.Dialog.fail(o,t.message)}}))})}),$(".makepicture").off("click").on("click",function(t){t.preventDefault();var a="Profilkép szolgáltató megváltoztatása",e=$(this).closest(".conn-wrap"),s=e.find(".logo").attr("title"),l=e.attr("data-prov");$.Dialog.confirm(a,"A profilkép szolgáltató módosításával megváltoztathatod, hogy melyik kép jelenjen meg az oldalon a neved mellett.<br>Átváltasz a(z) "+s+" szolgáltatónál használt profilképre?",["Váltás","Maradjon a régi"],function(t){t&&($.Dialog.wait(a),$.post("/profile/setavatarprovider",{provider:l},function(t){if("string"==typeof t)return console.log(t),$(window).trigger("ajaxerror"),!1;if(!t.status)return $.Dialog.fail(a,t.message);var s="undefined"==typeof l,n=e.parent(),i=n.children().last();n.children("[data-id]").remove(),$(t.connwraps).insertBefore(i),o(),i.find(".status").text(s?"Jelenlegi profilkép":"Nincs használatban").next().children(".makepicture").attr("disabled",s),$("#sidebar").find(".avatar img").attr("src",t.picture),$.Dialog.close()}))})});var e=function(t){t.preventDefault();var a=$(t.currentTarget).attr("data-id"),e="Szerepkör alapértelmezetté tétele";if("undefined"==typeof a)throw new Error('Nincs megadva "data-id" paraméter!');$.Dialog.wait(),$.ajax({method:"POST",url:"/profile/roles/changeDefault",data:{id:a},success:function(a){return"string"==typeof a?(console.log(a),$(window).trigger("ajaxerror"),!1):void(a.status?($(".js_changeDefault").prop("disabled",!1),$(t.currentTarget).prop("disabled",!0),$.Dialog.close()):$.Dialog.fail(e,a.message))}})};$(".js_changeDefault").on("click",e);var s=function(t){t.preventDefault();var a="Szerepkör leválasztása";if($(t.currentTarget).parent().find(".js_changeDefault").prop("disabled"))return $.Dialog.fail(a,"Az alapértelemeztt szerepkör leválasztása nem lehetséges! A leválasztás előtt jelöljön ki egy másik szerepkört alapértelmezettként!");var e=$(t.currentTarget).attr("data-id"),o=$("<p>Arra készül, hogy leválasztja a kiválasztott szerepkört a fiókjáról. Ez azt jelenti, hogy egy osztálybeli szerepkör leválasztása esetén nem lesz képes a továbbiakban hozzáférni az osztályhoz!<br>\t\t\t\t\t\t\tEz a művelet nem visszavonható, így kérem, erősítse meg szándékát a jelszava begépelésével!</p>\t\t\t\t\t\t\t<form id='js_form'>\t\t\t\t\t\t\t\t<p><strong>Jelenlegi jelszava:</strong> <input type='password' name='password' required placeholder='Jelenlegi jelszava\t\t\t\t\t\t\t\t'></p>\t\t\t\t\t\t\t\t<input type='hidden' name='id'>\t\t\t\t\t\t\t</form>");if("undefined"==typeof e)throw new Error('Nincs megadva "data-id" paraméter!');o.find("input[type=hidden]").attr("value",e),$.Dialog.request(a,o,"js_form","Leválasztás",function(t){t.on("submit",function(o){o.preventDefault();var s=t.serializeForm();$.Dialog.wait(),$.ajax({method:"POST",url:"/profile/roles/eject",data:s,success:function(t){if("string"==typeof t)return console.log(t),$(window).trigger("ajaxerror"),!1;if(t.status){if(1==t.reload)return window.location.reload();$(".conn-wrap[data-id="+e+"]").remove(),$.Dialog.close()}else $.Dialog.fail(a,t.message)}})})})};$(".js_eject").on("click",s)}();var e=$("#twofactor");e.on("click","#enable_2fa",function(t){t.preventDefault();var a=["Kétlépcsős azonosítás beállítása megszakítva","A beálltást bármikor újrakezdheted a Profilom menüpontban."];$.Dialog.confirm("Kétlépcsős azonosítás beállítása - Megerősítés","Biztos vagy benne, hogy megkezded a kétlépcsős azonosítás beállítását?",function(t){t&&$.Dialog.close(function(){var t=$.mk("div").attr({id:"twofa-step1","class":"twofa-step"}).append('<h3>1. lépés <span class="faded">&rsaquo; 2. lépés &rsaquo; 3. lépés</span></h3>\n\t\t\t\t\t<p>Szerezd be a platformodhoz készült kétlépcsős azonostó alkalmazást, és nyisd meg azt.<br>Alább listázunk pár gyakran használt alkalmazást:</p>\n\t\t\t\t\t<ul>\n\t\t\t\t\t\t<li>Android: <a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2">Google Authenticator</a></li>\n\t\t\t\t\t\t<li>iOS: <a href="https://itunes.apple.com/en/app/google-authenticator/id388497605?mt=8">Google Authenticator</a></li>\n\t\t\t\t\t\t<li>Windows Phone: <a href="https://www.microsoft.com/en-us/store/p/authenticator/9wzdncrfj3rj">Microsoft Authenticator</a></li>\n\t\t\t\t\t</ul>');$.Dialog.confirm("Kétlépcsős azonosítás beállítása - 1. lépés",t,["Folytatás","Beállítás elvetése"],function(t){return t?($.Dialog.wait(!1,"Kommunikáció a szerverrel, kis türelmet"),void $.post("/profile/2fa?a=enable&step=2",function(t){if("string"==typeof t)return console.log(t),$(window).trigger("ajaxerror"),!1;if(!t.status)return $.Dialog.fail(!1,t.message);var e=t.secret;$.Dialog.close(function(){var o=$.mk("div").attr({id:"twofa-step2","class":"twofa-step"}).append('<h3><span class="color-green">1. lépés</span> &rsaquo; 2. lépés <span class="faded">&rsaquo; 3. lépés</span></h3>\n\t\t\t\t\t\t\t\t<p>Az alkalmazásban keresd meg az új bejegyzés hozzáadása menüpontot, majd írd be az alábbi kódot:</p>\n\t\t\t\t\t\t\t\t<div class="twofa-code">'+e+'</div>\n\t\t\t\t\t\t\t\t<p>Amennyiben az alkalmazásod támogatja, beszkennelheted a telefon kamerája segítségével az alábbi QR kódot is:</p>\n\t\t\t\t\t\t\t\t<div class="twofa-img">\n\t\t\t\t\t\t\t\t\t<img src="'+t.qr+'">\n\t\t\t\t\t\t\t\t</div>');$.Dialog.confirm("Kétlépcsős azonosítás beállítása - 2. lépés",o,["Folytatás","Beállítás elvetése"],function(t){return t?void $.Dialog.close(function(){var t=$.mk("form").attr({id:"twofa-step3","class":"twofa-step"}).append('<h3><span class="color-green">1. lépés &rsaquo; 2. lépés</span> &rsaquo; 3. lépés</h3>\n\t\t\t\t\t\t\t\t\t\t<p>A párosítás befejezéséhez add meg az alkalmazás által generált kódot:</p>\n\t\t\t\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t\t\t\t<input type="text" name="code" minlength="6" maxlength="6" pattern="^\\d{6}$" title="6 számjegyből álló kód" required autocomplete="off">\n\t\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t\t\t<p>A Mégse gombbal még megszakíthatod a beállítást, de ha az űrlapot elküldöd, a fiókodban engedélyezésre kerül a kétlépcsős autentikáció. Kapni fogsz 10 tartalék kódot, amit biztonságos helyen érdemes tárolnod (lehetőleg ne a számítógépen). Ezekkel tudsz hozzáférni a fiókodhoz, ha a hordoható eszközöd nincs kézél vagy ellopják.</p>');$.Dialog.request("Kétlépcsős azonosítás beállítása - 3. lépés",t,"twofa-step3","Befejezés",function(t){t.on("submit",function(a){a.preventDefault();var o=t.serializeForm();o.secret=e,$.Dialog.wait(!1,"Beállítás véglegesítése"),$.post("/profile/2fa?a=enable&step=3",o,function(t){return"string"==typeof t?(console.log(t),$(window).trigger("ajaxerror"),!1):t.status?void $.Dialog.close(function(){t.twofactor_html&&$("#twofactor").html(t.twofactor_html),$.Dialog.success("Kétlépcsős azonosítás beállítva",t.message,!0)}):$.Dialog.fail(!1,t.message)})})})}):$.Dialog.info.apply($.Dialog,a)})})})):$.Dialog.apply($.Dialog,a)})})})}),e.on("click","#disable_2fa",function(t){t.preventDefault(),$.Dialog.confirm("Kétlépcsős azonosítás kikapcsolása","Biztos vagy benne, hogy kikapcsolod a kétlépcsős azonosítást?",function(t){t&&($.Dialog.wait(!1,"Kommunikáció a szerverrel, kis türelmet"),$.post("/profile/2fa?a=disable",function(t){return"string"==typeof t?(console.log(t),$(window).trigger("ajaxerror"),!1):t.status?(t.twofactor_html&&$("#twofactor").html(t.twofactor_html),void $.Dialog.success(!1,t.message,!0)):$.Dialog.fail(!1,t.message)}))})}),e.on("click","#2fa_backupcodes",function(t){t.preventDefault(),$.Dialog.wait(!1,"Kommunikáció a szerverrel, kis türelmet"),$.post("/profile/2fa?a=codes",function(t){if("string"==typeof t)return console.log(t),$(window).trigger("ajaxerror"),!1;var a="Kétlépcsős azonosítás - Tartalék kódok";return t.status?void function e(t){$.Dialog.info(a,"Ha elveszted a hordozható eszközöd, ezekkel be tudsz lépni a fiókodba az alkalmazás által generált kód helyett.\n\t\t\t\t\t"+t.codes_html+'\n\t\t\t\t\t<p>Ha bármilyen okból meg szeretnéd újítani ezeket a kódokat (elfogytak, rossz kezekbe kerültek) kattints az alábbi gombra:</p><button id="2fa_backupregen" class="btn typcn typcn-refresh">Kódok megújítása</button></p>',function(){$("#2fa_backupregen").on("click",function(t){t.preventDefault(),$.Dialog.close(function(){$.Dialog.confirm("Tartalék kódok megújítása","Biztosan le szeretnéd cserélni a mostani tartalék kódokat?",function(t){t&&($.Dialog.wait(!1,"Kommunikáció a szerverrel, kis türelmet"),$.post("/profile/2fa?a=codes&regen",function(t){return"string"==typeof t?(console.log(t),$(window).trigger("ajaxerror"),!1):t.status?($.Dialog.success(!1,"Kódok sikeresen újragenerálva"),void e(t)):$.Dialog.fail(!1,t.message)}))})})})})}(t):$.Dialog.fail(a,t.message)})})});
//# sourceMappingURL=profile.js.map
