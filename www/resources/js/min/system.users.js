"use strict";$(function(){$("#js_hideShowFilter").on("click",function(){var t=$(this),e=$("#filterFormContainer");t.toggleClass("typcn-arrow-up-thick typcn-arrow-down-thick hide show"),e[t.hasClass("hide")?"show":"hide"](),t.text(t.hasClass("hide")?"Szűrőpanel összecsukása":"Szűrőpanel kinyitása"),t.blur()}),$("#filterForm").on("submit",function(t){t.preventDefault();var e=$(this).serializeForm(),a="Felhasználók szűrése";e.noSidebar=noSidebar,$.Dialog.wait(),$.ajax({method:"POST",url:"/system.users/filter",data:e,success:function(t){return"string"==typeof t?(console.log(t),$(window).trigger("ajaxerror"),!1):void(t.status?($("#resultContainer").empty().append(t.html),$.Dialog.close(),$(".js_filterUsers").blur()):$.Dialog.fail(a,t.message))}})});var t=$("<form id='js_form'>\n\t\t\t\t\t\t<p>Felhasználónév: <input type='text' name='username' placeholder='Felhasználónév' required></p>\n\t\t\t\t\t\t<p>E-mail cím: <input type='text' name='email' placeholder='name@domain.tld' required></p>\n\t\t\t\t\t\t<p>Teljes név: <input type='text' name='name' placeholder='Vezetéknév Keresztnév' required></p>\n\t\t\t\t\t\t<input type='hidden' name='id' value=''>\n\t\t\t\t\t</form>"),e=$("<form id='js_form'>\n\t\t\t\t\t\t\t<p>Milyen műveletet szeretne végrehajtani?</p>\n\t\t\t\t\t\t\t<label style='text-align:left'><input type='radio' name='action' value='edit' required checked> <strong>Szerkesztés</strong></label>\n\t\t\t\t\t\t\t<label style='text-align:left'><input type='radio' name='action' value='delete' required id='roleDelete'> <strong>Törlés</strong></label>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<p>Kérem válassza ki a szerkeszteni vagy törölni kívánt szerepkört:</p>\n\t\t\t\t\t\t\t</form>"),a=$("<form id='js_form_edit'>\n\t\t\t\t\t\t\t<p>Jogosultság:\n\t\t\t\t\t\t\t\t<select name='role'>\n\t\t\t\t\t\t\t\t\t<option value='visitor' selected>Ált. felhasználó</option>\n\t\t\t\t\t\t\t\t\t<option value='editor'>Szerkesztő</option>\n\t\t\t\t\t\t\t\t\t<option value='admin'>Csoport adminisztrátor</option>\n\t\t\t\t\t\t\t\t\t<!--<option value='teacher'>Tanár</option>-->\n\t\t\t\t\t\t\t\t</select></p>\n\t\t\t\t\t\t\t\t<input type='hidden' name='id'>\n\t\t\t\t\t\t\t</form>"),r=$("<form id='js_form'>\n\t\t\t\t\t\t\t<p class='actual'><strong>Aktuális állapot: </strong><span></span></p>\n\t\t\t\t\t\t\t<p>Válasszon műveletet:</p>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<label style='text-align:left'>\n\t\t\t\t\t\t\t\t<input type='radio' name='action' value='new' required> <strong>Hozzáférés létrehozása</strong>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t<label style='text-align:left'>\n\t\t\t\t\t\t\t\t<input type='radio' name='action' value='update' required> <strong>Meglévő hozzáférés frissítése</strong>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t<label style='text-align:left'>\n\t\t\t\t\t\t\t\t<input type='radio' name='action' value='remove' required> <strong>Hozzáférés törlése</strong>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</form>");$("#js_editUserInfos").on("click",function(e){e.preventDefault();var a=$(e.currentTarget).attr("data-id"),r="Felhasználó alapadatainak szerkesztése";$.Dialog.wait(r,"Alapadatok lekérdezése"),$.ajax({method:"POST",url:"/system.users/get/userInfos",data:{id:a},success:function(e){if("string"==typeof e)return console.log(e),$(window).trigger("ajaxerror"),!1;if(e.status){var s=t.clone();s.find("[name=name]").attr("value",e.name),s.find("[name=username]").attr("value",e.username),s.find("[name=email]").attr("value",e.email),s.find("[name=id]").attr("value",a),$.Dialog.request(r,s,"js_form","Mentés",function(t){t.on("submit",function(e){e.preventDefault();var a=t.serializeForm();$.Dialog.wait(r),$.ajax({method:"POST",url:"/system.users/editBasicInfos",data:a,success:function(t){return"string"==typeof t?(console.log(t),$(window).trigger("ajaxerror"),!1):void(t.status?($.Dialog.success(r,t.message),setTimeout(function(){window.location.reload()},1500)):$.Dialog.fail(r,t.message))}})})})}else $.Dialog.fail(r,e.message)}})}),$("#js_deleteUser").on("click",function(t){t.preventDefault();var e=$(t.currentTarget).attr("data-id"),a="Felhasználó eltávolítása a rendszerből";$.Dialog.confirm(a,"A felhasználó törlésével teljesen eltávolításra kerülnek a hozzá kapcsolódó információk és személyes adatok a rendszerből! Csak akkor töröljön egy felhasználót, ha az feltétlenül szükséges! Folytatja?",["Felhasználó törlése","Visszalépés"],function(t){t&&($.Dialog.wait(a),$.ajax({method:"POST",url:"/system.users/deleteUser",data:{id:e},success:function(t){return"string"==typeof t?(console.log(t),$(window).trigger("ajaxerror"),!1):void(t.status?($.Dialog.success(a,t.message),setTimeout(function(){window.location.reload()},1500)):$.Dialog.fail(a,t.message))}}))})}),$("#js_btEdit").on("click",function(t){t.preventDefault();var e=$(t.currentTarget).attr("data-id"),a="BugTracker állapot szerkesztése";$.Dialog.wait(a,"Aktuális állapot lekérdezése"),$.ajax({method:"POST",url:"/system.users/get/bugTrackerStatus",data:{id:e},success:function(t){if("string"==typeof t)return console.log(t),$(window).trigger("ajaxerror"),!1;if(t.status){var s=r.clone();for(var n in t.data)if(t.data.hasOwnProperty(n)){var l=t.data[n];s.find("[value="+n+"]").attr("disabled",!l)}s.find("span").text(t.conn_status),$.Dialog.request(a,s,"js_form","Művelet végrehajtása",function(){var t=$("#js_form");t.on("submit",function(r){r.preventDefault();var s={"new":"Arra készül, hogy létrehoz egy új felhasználót a BugTracker rendszerben a kiválasztott CuStudy-felhasználó jelenlegi adataival! Folytatja?",update:"Arra készül, hogy frissíti a kiválasztott CuStudy-felhasználóhoz kapcsolódó BugTracker felhasználó adatait a CuStudy rendszerben találhatóakkal! Folytatja?",remove:"Arra készül, hogy törli a kiválasztott CuStudy-felhasználóhoz kapcsolódó BugTracker-felhasználót a rendszerből! A művelet nem visszavonható! Folytatja?"};$.each(t.find("input"),function(t,r){var n=$(r);if(n.prop("checked")){var l=n.attr("value");$.Dialog.confirm(a,s[l],["Igen","Nem"],function(t){t&&($.Dialog.wait(a),$.ajax({method:"POST",url:"/system.users/editBugTrackerStatus",data:{id:e,action:l},success:function(t){return"string"==typeof t?(console.log(t),$(window).trigger("ajaxerror"),!1):void(t.status?($.Dialog.success(a,t.message),setTimeout(function(){window.location.reload()},1500)):$.Dialog.fail(a,t.message))}}))})}})})})}}})}),$("#js_editRoles").on("click",function(t){t.preventDefault();var r=$(t.currentTarget).attr("data-id"),s="Felhasználó szerepköreinek lekérdezése";$.Dialog.wait(s,"Az elérhető szerepkörök lekérdezése folyamatban"),$.ajax({method:"POST",url:"/system.users/get/roles",data:{id:r},success:function(t){if("string"==typeof t)return console.log(t),$(window).trigger("ajaxerror"),!1;if(t.status){var n=$('<label style="text-align:left"><input type="radio" name="role" required> <b class="school"></b>: <span class="role"></span></label>'),l=0,o=e.clone(),i=t.roles;if(0==i.length)return $.Dialog.fail(s,"Nincs szerkeszthető vagy törölhető szerepkör!");for(l=0;l<i.length;l++){var u=n.clone(),d=i[l];u.find("input").attr("value",d.id),u.find(".school").text(d.school),u.find(".role").text(d.role),o.filter("form").append(u)}$.Dialog.request(s,o,"js_form","Művelet végrehajtása",function(){var t=$("#js_form");t.on("submit",function(e){e.preventDefault(),t.find("input").attr("disabled",!0);var n=t.find(":checked").filter("[name=role]");return 0==n.length?$.Dialog.fail(s,"A művelet nem folytatható, mert nincs kiválasztott szerepkör!"):void(t.find("#roleDelete").prop("checked")?$.Dialog.confirm(s,"A kiválasztott szerepkör törlésére készül! Folytatja a műveletet?",["Szerepkör törlése","Visszalépés"],function(t){t&&($.Dialog.wait(s),$.ajax({method:"POST",url:"/system.users/deleteRole",data:{id:n.attr("value"),userId:r},success:function(t){return"string"==typeof t?(console.log(t),$(window).trigger("ajaxerror"),!1):void(t.status?($.Dialog.success(s,t.message),setTimeout(function(){window.location.reload()},1500)):$.Dialog.fail(s,t.message))}}))}):($.Dialog.wait(s,"Szerepkör adatainak lekérdezése"),$.ajax({method:"POST",url:"/system.users/get/role",data:{id:n.attr("value")},success:function(t){if("string"==typeof t)return console.log(t),$(window).trigger("ajaxerror"),!1;if(t.status){var e=a.clone();e.find("[name=role]").children("option[value="+t.role+"]").attr("selected",!0),e.find("[name=id]").attr("value",n.attr("value")),$.Dialog.request(s,e,"js_form_edit","Művelet végrehajtása",function(){var t=$("#js_form_edit");t.on("submit",function(e){e.preventDefault(),$.Dialog.wait(s,"Módosítások mentése"),$.ajax({method:"POST",url:"/system.users/editRole",data:t.serializeForm(),success:function(t){return"string"==typeof t?(console.log(t),$(window).trigger("ajaxerror"),!1):void(t.status?($.Dialog.success(s,t.message),setTimeout(function(){window.location.reload()},1e3)):$.Dialog.fail(s,t.message))}})})})}else $.Dialog.fail(s,t.message)}})))})})}}})})});
//# sourceMappingURL=system.users.js.map
